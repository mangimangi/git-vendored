{"id":"gv-d942","title":"Refactor install into add + update","status":"open","issue_type":"epic","priority":2,"created_at":"2026-02-10T04:38:09Z"}
{"id":"gv-d942.1","title":"Rename vendored/install to vendored/update","status":"closed","issue_type":"task","priority":2,"created_at":"2026-02-10T04:48:39Z","parent":"gv-d942","body":"Rename the install script to update, reflecting that it only operates on already-registered vendors.\n\n## Scope\n\n- Rename `vendored/install` \u2192 `vendored/update`\n- Rename `tests/test_install.py` \u2192 `tests/test_update.py`\n- Update internal references in the test file (dynamic import path, module name)\n- Improve unknown-vendor error to list registered vendors:\n  ```\n  ::error::Unknown vendor: typo-name\n  Registered vendors: git-vendored, git-semver, git-dogfood, pearls\n  ```\n\n## Acceptance Criteria\n\n- [ ] `vendored/install` no longer exists; `vendored/update` exists with identical logic\n- [ ] `tests/test_install.py` no longer exists; `tests/test_update.py` exists\n- [ ] All tests pass after the rename (dynamic import path and any internal references updated)\n- [ ] Unknown vendor error message includes a list of registered vendor names from config\n- [ ] No other files reference the old `vendored/install` path (except install.sh and workflow template \u2014 those are handled in later issues)","deps":[{"id":"gv-d942.2","type":"blocks"},{"id":"gv-d942.5","type":"blocks"}],"started_at":"2026-02-10T05:01:46Z","commit":"566dd60","implementer":"claude-opus-4-6","cost":{"input":35000,"output":8000},"implemented_at":"2026-02-10T05:03:36Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-10T05:21:04Z","scores":{"correctness":95,"completeness":95,"quality":90,"testing":88,"documentation":85},"score":90.6},"closed_at":"2026-02-10T05:21:54Z"}
{"id":"gv-d942.2","title":"Write GITHUB_OUTPUT directly from Python in vendored/update","status":"closed","issue_type":"task","priority":2,"created_at":"2026-02-10T04:48:56Z","parent":"gv-d942","body":"Have vendored/update write workflow outputs directly to $GITHUB_OUTPUT instead of relying on fragile grep/cut/python stdout parsing in the workflow shell step.\n\n## Scope\n\n**Edit `vendored/update`:**\n- When `$GITHUB_OUTPUT` env var is set, write key=value pairs to that file:\n  - Single-vendor mode: `vendor`, `old_version`, `new_version`, `changed`, `install_branch`\n  - All-vendors mode: `changed_vendors` (JSON), `changed_count`\n- Continue printing human-readable stdout output (useful for local runs and logs)\n\n**Edit `templates/github/workflows/install-vendored.yml`:**\n- Remove the grep/cut/python one-liner parsing of stdout\n- Reference step outputs directly (e.g., `steps.update.outputs.changed`)\n\n**Edit `tests/test_update.py`:**\n- Add tests that verify GITHUB_OUTPUT file is written correctly when the env var is set\n- Add tests that verify no GITHUB_OUTPUT file is written when the env var is not set\n- Existing stdout-based tests should still pass (human-readable output preserved)\n\n## Acceptance Criteria\n\n- [ ] `vendored/update` writes key=value pairs to `$GITHUB_OUTPUT` file when env var is set\n- [ ] Stdout output is preserved for human readability\n- [ ] Workflow template no longer parses stdout \u2014 uses step outputs directly\n- [ ] `tests/test_update.py` includes tests for GITHUB_OUTPUT writing (set and unset)\n- [ ] All existing tests pass","deps":[{"id":"gv-d942.1","type":"blocked_by"},{"id":"gv-d942.3","type":"precedes"}],"started_at":"2026-02-10T05:05:50Z","commit":"1894c6a","implementer":"claude-opus-4-6","cost":{"input":40000,"output":12000},"implemented_at":"2026-02-10T05:07:15Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-10T05:21:07Z","scores":{"correctness":90,"completeness":90,"quality":85,"testing":90,"documentation":80},"score":87.0},"closed_at":"2026-02-10T05:21:58Z"}
{"id":"gv-d942.3","title":"Fix workflow token leaking and automerge default","status":"closed","issue_type":"task","priority":2,"created_at":"2026-02-10T04:49:13Z","parent":"gv-d942","body":"Fix two issues in the workflow template: VENDOR_PAT leaking into PR creation, and automerge defaulting to true.\n\n## Scope\n\n**Token fix in `templates/github/workflows/install-vendored.yml`:**\n- Update step uses VENDOR_PAT (for private repo downloads): `GH_TOKEN: ${{ secrets.token || secrets.VENDOR_PAT || github.token }}`\n- PR creation step always uses github.token: `GH_TOKEN: ${{ github.token }}`\n- This prevents a PAT scoped for private repo reads from being used for PR operations on public vendors\n\n**Automerge default fix:**\n- Default automerge to `false` in the workflow\n- Only automerge when the vendor's config explicitly has `\"automerge\": true`\n- Document the default in the config shape\n\n**PR creation improvements:**\n- Add `--head \"$BRANCH\"` to `gh pr create` command\n- Handle \"PR already exists\" case gracefully (don't fail the workflow)\n\n## Acceptance Criteria\n\n- [ ] PR creation step uses `${{ github.token }}`, not VENDOR_PAT\n- [ ] Update/download step retains VENDOR_PAT for private repo access\n- [ ] Automerge defaults to `false` \u2014 only enabled when vendor config has `\"automerge\": true`\n- [ ] `gh pr create` includes `--head` flag with the branch name\n- [ ] Workflow does not fail if a PR already exists for the branch\n- [ ] All existing tests pass","deps":[{"id":"gv-d942.2","type":"follows"},{"id":"gv-d942.8","type":"causes"}],"started_at":"2026-02-10T05:07:29Z","commit":"fca823f","implementer":"claude-opus-4-6","cost":{"input":25000,"output":5000},"implemented_at":"2026-02-10T05:08:14Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-10T05:21:11Z","scores":{"correctness":92,"completeness":85,"quality":88,"testing":55,"documentation":78},"score":79.6},"closed_at":"2026-02-10T05:32:52Z"}
{"id":"gv-d942.4","title":"Create vendored/add command","status":"closed","issue_type":"task","priority":2,"created_at":"2026-02-10T04:49:44Z","parent":"gv-d942","body":"New command for first-time vendor registration. Run locally by the user (not by workflows).\n\n## Scope\n\n**New file: `vendored/add`**\n\nUsage: `python3 .vendored/add <owner/repo> [--name <name>]`\n\nFlow:\n1. **Pre-validate** the target repo:\n   - Confirm `install.sh` exists at repo root (via `gh api repos/{owner/repo}/contents/install.sh`)\n   - Confirm version is resolvable (GitHub Releases API or VERSION file fallback)\n   - Fail with \"repo does not implement git-vendored\" if either is missing\n2. **Snapshot** `.vendored/config.json` (before state)\n3. **Run** the vendor's `install.sh` (download and execute with resolved version)\n4. **Post-validate** the config entry the vendor registered:\n   - Diff config before/after to find the new entry\n   - Required fields: `repo`, `protected`, `install_branch`\n   - Fail if `install.sh` didn't register itself\n5. **Output** summary of what was added (vendor name, version, registered files)\n\nError cases:\n- Repo doesn't exist or is inaccessible \u2192 error with auth hint\n- No `install.sh` found \u2192 \"repo does not implement git-vendored\"\n- `install.sh` didn't write a config entry \u2192 \"install.sh must self-register\"\n- Vendor already registered \u2192 error suggesting to use update instead\n\n**New file: `tests/test_add.py`**\n\nFollow existing test patterns: dynamic module import, `tmp_repo` + `make_config` fixtures, `monkeypatch` for env vars, `unittest.mock.patch` for subprocess calls.\n\n### Test Plan\n\n**TestPreValidate:**\n- `test_repo_with_install_sh_passes` \u2014 Mock GitHub API returns install.sh \u2192 no error\n- `test_repo_without_install_sh_fails` \u2014 Mock API returns 404 \u2192 exits with \"does not implement git-vendored\"\n- `test_repo_not_found_fails` \u2014 Mock API returns 404 for repo \u2192 exits with auth hint\n- `test_version_resolvable_from_releases` \u2014 Mock releases API returns tag \u2192 version resolved\n- `test_version_resolvable_from_version_file` \u2014 Mock releases fails, VERSION file fallback works\n- `test_version_not_resolvable_fails` \u2014 Both methods fail \u2192 exits with error\n\n**TestSnapshotAndDiff:**\n- `test_detects_new_config_entry` \u2014 Config before has 1 vendor, after has 2 \u2192 new entry found\n- `test_no_new_entry_fails` \u2014 Config unchanged after install.sh \u2192 exits with \"must self-register\"\n\n**TestPostValidate:**\n- `test_valid_entry_passes` \u2014 New entry has repo, protected, install_branch \u2192 success\n- `test_missing_repo_fails` \u2014 Missing repo \u2192 exits with clear message\n- `test_missing_protected_fails` \u2014 Missing protected \u2192 exits with clear message\n- `test_missing_install_branch_fails` \u2014 Missing install_branch \u2192 exits with clear message\n\n**TestAddVendor (integration):**\n- `test_add_new_vendor` \u2014 Full flow: pre-validate \u2192 run install.sh \u2192 post-validate \u2192 success output\n- `test_add_already_registered_fails` \u2014 Vendor already in config \u2192 exits with \"already registered\"\n- `test_add_with_custom_name` \u2014 `--name` flag overrides vendor key in config lookup\n\n**TestAddOutput:**\n- `test_summary_shows_vendor_name` \u2014 Output includes vendor name\n- `test_summary_shows_version` \u2014 Output includes installed version\n- `test_summary_shows_registered_files` \u2014 Output includes what install.sh added to config\n\n## Acceptance Criteria\n\n- [ ] `vendored/add` exists and is executable\n- [ ] Pre-validates target repo has `install.sh` and resolvable version\n- [ ] Snapshots config, runs vendor's install.sh, then post-validates the new config entry\n- [ ] Post-validation checks for required fields: `repo`, `protected`, `install_branch`\n- [ ] Clear error messages for all failure cases (no install.sh, no version, no self-registration, already registered)\n- [ ] `--name` flag allows overriding the vendor key\n- [ ] `tests/test_add.py` exists with all test cases from the test plan above\n- [ ] All tests pass","deps":[{"id":"gv-d942.5","type":"blocks"}],"started_at":"2026-02-10T05:03:48Z","commit":"191a4a1","implementer":"claude-opus-4-6","cost":{"input":45000,"output":15000},"implemented_at":"2026-02-10T05:05:38Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-10T05:21:14Z","scores":{"correctness":90,"completeness":92,"quality":88,"testing":92,"documentation":85},"score":89.4},"closed_at":"2026-02-10T05:22:01Z"}
{"id":"gv-d942.5","title":"Update install.sh bootstrap for add/update rename and migration","status":"closed","issue_type":"task","priority":2,"created_at":"2026-02-10T04:50:03Z","parent":"gv-d942","body":"Update the bootstrap install.sh to download the new files, clean up the old install script, and patch existing workflow files.\n\n## Scope\n\n**Edit `install.sh`:**\n\nDownload changes:\n- Download `vendored/add` \u2192 `.vendored/add` (new)\n- Download `vendored/update` \u2192 `.vendored/update` (renamed from install)\n- Download `vendored/check` \u2192 `.vendored/check` (unchanged)\n\nMigration cleanup:\n- `rm -f .vendored/install` \u2014 remove the old script from repos that had it installed\n\nWorkflow patching:\n- After downloading files, patch existing workflow files that reference the old path\n- In `.github/workflows/install-vendored.yml`, replace `python3 .vendored/install` with `python3 .vendored/update`:\n  ```bash\n  if [ -f .github/workflows/install-vendored.yml ]; then\n      sed -i 's|python3 \\.vendored/install|python3 .vendored/update|g' \\\n          .github/workflows/install-vendored.yml\n  fi\n  ```\n\nUnchanged:\n- Self-registration logic stays\n- First-install-only guard for workflow templates stays\n\n**Edit `tests/test_installer.py`:**\n- Update tests to verify `.vendored/add` is downloaded and executable\n- Update tests to verify `.vendored/update` is downloaded (not `.vendored/install`)\n- Add test verifying `rm -f .vendored/install` cleanup occurs\n- Add test verifying workflow patching (sed replacement) works\n\n## Acceptance Criteria\n\n- [ ] `install.sh` downloads `vendored/add` \u2192 `.vendored/add`\n- [ ] `install.sh` downloads `vendored/update` \u2192 `.vendored/update`\n- [ ] `install.sh` runs `rm -f .vendored/install` to clean up old script\n- [ ] `install.sh` patches `.github/workflows/install-vendored.yml` to replace old path references\n- [ ] `.vendored/add` and `.vendored/update` are executable after install\n- [ ] `tests/test_installer.py` updated with tests for new download targets, cleanup, and patching\n- [ ] All tests pass","deps":[{"id":"gv-d942.1","type":"blocked_by"},{"id":"gv-d942.4","type":"blocked_by"},{"id":"gv-d942.6","type":"precedes"},{"id":"gv-d942.7","type":"causes"}],"started_at":"2026-02-10T05:08:26Z","commit":"140a2f3","implementer":"claude-opus-4-6","cost":{"input":30000,"output":10000},"implemented_at":"2026-02-10T05:09:53Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-10T05:21:18Z","scores":{"correctness":90,"completeness":85,"quality":85,"testing":88,"documentation":82},"score":86.0},"closed_at":"2026-02-10T05:22:06Z"}
{"id":"gv-d942.6","title":"Create project README","status":"closed","issue_type":"task","priority":2,"created_at":"2026-02-10T04:50:23Z","parent":"gv-d942","body":"Create a comprehensive but simple README.md for the git-vendored project.\n\n## Scope\n\n**New file: `README.md`**\n\nThe README should cover:\n\n1. **What git-vendored is** \u2014 one-paragraph summary: automated vendor install control for repo-embedded tools via GitHub workflows\n2. **How it works** \u2014 brief explanation of the vendor contract (install.sh + config self-registration + version discovery)\n3. **Quick start** \u2014 how to bootstrap git-vendored in a new repo (run install.sh)\n4. **Adding a vendor** \u2014 usage of `vendored/add` command\n5. **How updates work** \u2014 the automated workflow: schedule/manual trigger \u2192 vendored/update \u2192 PR creation\n6. **Configuration** \u2014 `.vendored/config.json` structure with field descriptions (repo, protected, allowed, install_branch, private, automerge, dogfood)\n7. **Vendor contract** \u2014 what a vendor repo must provide (install.sh at root, version via GitHub Releases or VERSION file, self-registration in config)\n8. **Protection rules** \u2014 how vendored/check enforces protected file patterns\n\nKeep it simple and practical \u2014 favor examples over prose. No need to document internal implementation details.\n\n## Acceptance Criteria\n\n- [ ] `README.md` exists at the repo root\n- [ ] Covers all sections listed above\n- [ ] Reflects the post-refactoring state (add/update commands, not the old install command)\n- [ ] Includes concrete usage examples (commands, config snippets)\n- [ ] Simple and concise \u2014 no unnecessary verbosity","deps":[{"id":"gv-d942.5","type":"follows"}],"started_at":"2026-02-10T05:10:08Z","commit":"b8119bb","implementer":"claude-opus-4-6","cost":{"input":15000,"output":4000},"implemented_at":"2026-02-10T05:10:52Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-10T05:21:21Z","scores":{"correctness":95,"completeness":92,"quality":90,"testing":80,"documentation":95},"score":90.4},"closed_at":"2026-02-10T05:22:09Z"}
{"id":"gv-2253","title":"1shots","status":"open","issue_type":"epic","priority":2,"created_at":"2026-02-10T05:30:48Z","body":"Small, single-session work items."}
{"id":"gv-2253.1","title":"Add pre-commit hook for vendor file protection","status":"implemented","issue_type":"task","priority":2,"created_at":"2026-02-10T05:31:06Z","parent":"gv-2253","body":"Add a pre-commit hook that enforces the same vendor file protection as the check-vendor GHA workflow, vendored to consumer repos via install.sh.\n\n## Design\n\n- Add `--staged` flag to `vendored/check` \u2014 checks `git diff --cached --name-only` (staged files) instead of branch diff\n- Create `vendored/hooks/pre-commit` \u2014 thin shell script calling `python3 .vendored/check --staged`\n- Add `--install-hook` flag to `vendored/check` \u2014 symlinks `.vendored/hooks/pre-commit` into `.git/hooks/pre-commit`, force-overwriting any existing hook (including pearls)\n- Update `install.sh` to download the hook to `.vendored/hooks/pre-commit`\n\n## Acceptance criteria\n\n### `--staged` mode\n- [ ] `vendored/check --staged` checks staged files via `git diff --cached --name-only`\n- [ ] Reuses all existing protection logic (patterns, allowed lists, install-branch skip)\n- [ ] Exits 0 if no staged violations, 1 if violations found\n- [ ] Works both in CI and locally (no dependency on GitHub env vars)\n\n### `vendored/hooks/pre-commit`\n- [ ] Shell script at `vendored/hooks/pre-commit` that runs `python3 .vendored/check --staged`\n- [ ] Exits with the check script exit code\n- [ ] Executable permissions set\n\n### `--install-hook` mode\n- [ ] `vendored/check --install-hook` symlinks `.git/hooks/pre-commit` to `.vendored/hooks/pre-commit` (relative: `../../.vendored/hooks/pre-commit`)\n- [ ] Force-overwrites any existing pre-commit hook (file or symlink) \u2014 squashes pearls etc.\n- [ ] Verifies `.vendored/hooks/pre-commit` exists before symlinking, errors if missing\n- [ ] Prints confirmation message on success\n\n### install.sh\n- [ ] Downloads `vendored/hooks/pre-commit` to `.vendored/hooks/pre-commit`\n- [ ] Sets executable permissions (`chmod +x`)\n- [ ] Creates `.vendored/hooks/` directory\n\n### Tests\n- [ ] Unit tests for `--staged` mode in `tests/test_check.py` (staged files checked, protection logic applied, violations reported)\n- [ ] Unit test for `--install-hook` (symlink created, overwrites existing, errors on missing hook file)\n\n### Docs\n- [ ] Update `install.sh` header comment to document the new hook file\n- [ ] Add `--staged` and `--install-hook` to the check script docstring","references":[{"file":"vendored/check"},{"file":"install.sh"},{"file":"vendored/hooks/pre-commit"}],"estimates":[{"estimator":"claude-opus-4-6","implementer":"claude-opus-4-6","cost":{"input":40000,"output":15000}}],"started_at":"2026-02-10T05:31:36Z","commit":"22a3a3e","implementer":"claude-opus-4-6","cost":{"input":55000,"output":12000},"implemented_at":"2026-02-10T05:35:17Z"}
{"id":"gv-d942.7","title":"Workflow template changes not propagated to existing consumer repos on upgrade","status":"closed","issue_type":"bug","priority":2,"created_at":"2026-02-10T05:21:42Z","parent":"gv-d942","references":[{"file":"install.sh","lines":["82-88"]},{"commit":"140a2f3"}],"deps":[{"id":"gv-d942.5","type":"caused_by"}],"started_at":"2026-02-10T05:29:21Z","commit":"5cd5236","implementer":"claude-opus-4-6","cost":{"input":50000,"output":8000},"implemented_at":"2026-02-10T05:30:54Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-10T05:32:36Z","scores":{"correctness":95,"completeness":95,"quality":90,"testing":90,"documentation":85},"score":91.0},"closed_at":"2026-02-10T05:32:52Z"}
{"id":"gv-d942.8","title":"No tests for workflow token/automerge changes","status":"closed","issue_type":"bug","priority":2,"created_at":"2026-02-10T05:21:46Z","parent":"gv-d942","deps":[{"id":"gv-d942.3","type":"caused_by"}],"references":[{"commit":"fca823f"}],"started_at":"2026-02-10T05:31:06Z","commit":"8e02872","implementer":"claude-opus-4-6","cost":{"input":30000,"output":5000},"implemented_at":"2026-02-10T05:32:24Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-10T05:32:44Z","scores":{"correctness":95,"completeness":92,"quality":90,"testing":95,"documentation":82},"score":90.8},"closed_at":"2026-02-10T05:32:52Z"}
{"id":"gv-cf3f","title":"Vendor contract v2: manifest-driven install/check/remove","status":"open","issue_type":"epic","priority":1,"created_at":"2026-02-11T02:11:29Z","body":"Redesign the vendor contract around a manifest-based approach. Flatten repo structure, merge add+update into install, add remove command, and shift version/metadata ownership to the framework.","estimates":[{"estimator":"claude-opus-4-6","implementer":"claude-opus-4-6","cost":{"input":165000,"output":59000}}],"deps":[{"id":"gv-a34c","type":"blocks"}]}
{"id":"gv-cf3f.1","title":"Flatten repo structure into templates/","status":"closed","issue_type":"task","priority":1,"created_at":"2026-02-11T04:13:12Z","parent":"gv-cf3f","body":"Move all installable files under a single `templates/` directory. Currently source files are split between `vendored/` (scripts) and `templates/` (config + workflows) for no clear reason.\n\n## Acceptance Criteria\n\n### File moves\n- [ ] `vendored/add` \u2192 `templates/add`\n- [ ] `vendored/update` \u2192 `templates/update`\n- [ ] `vendored/check` \u2192 `templates/check`\n- [ ] `vendored/hooks/pre-commit` \u2192 `templates/hooks/pre-commit`\n- [ ] `templates/vendored/config.json` \u2192 `templates/config.json`\n- [ ] `vendored/` directory deleted (empty after moves)\n- [ ] `templates/vendored/` directory deleted (empty after moves)\n\n### install.sh updates\n- [ ] `fetch_file` calls reference `templates/add`, `templates/update`, `templates/check`, `templates/hooks/pre-commit` instead of `vendored/...`\n- [ ] Config template fetched from `templates/config.json` instead of `templates/vendored/config.json`\n- [ ] install.sh still passes all existing test_installer.py tests (after path updates in tests)\n\n### Housekeeping\n- [ ] `.semver/config.json` `files` array: remove `vendored/*` (now redundant since `templates/*` already covers it)\n- [ ] All test imports updated: `ROOT / \"vendored\" / \"add\"` \u2192 `ROOT / \"templates\" / \"add\"`, etc.\n- [ ] All existing tests pass with the new paths\n\n### Out of scope\n- Renaming scripts (add\u2192install, etc.) \u2014 that's gv-cf3f.2\n- Manifest storage \u2014 that's gv-cf3f.3","deps":[{"id":"gv-cf3f.2","type":"blocks"}],"estimates":[{"estimator":"claude-opus-4-6","implementer":"claude-opus-4-6","cost":{"input":20000,"output":6000}}],"started_at":"2026-02-11T05:03:30Z","commit":"2557a63","implementer":"claude-opus-4-6","cost":{"input":60000,"output":8000},"implemented_at":"2026-02-11T05:05:32Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T05:41:48Z","scores":{"correctness":95,"completeness":95,"quality":92,"testing":88,"documentation":82},"score":90.4},"closed_at":"2026-02-11T05:41:56Z"}
{"id":"gv-cf3f.2","title":"Merge add+update into unified install command","status":"closed","issue_type":"task","priority":1,"created_at":"2026-02-11T04:13:37Z","parent":"gv-cf3f","body":"Create a single `templates/install` script that replaces both `templates/add` and `templates/update`. The command is idempotent: it detects whether the vendor exists and handles both first-time add and update flows.\n\n## Acceptance Criteria\n\n### Unified command\n- [ ] `templates/install` exists, executable, handles both add and update\n- [ ] Usage: `.vendored/install <owner/repo> [--version <version>] [--force] [--pr] [--name <name>]`\n- [ ] If vendor not registered: pre-validate (repo exists, has install.sh, version resolvable), run install.sh, post-validate (self-registered with required fields)\n- [ ] If vendor already registered: resolve version, skip if already at target (unless `--force`), download and run install.sh\n- [ ] `--pr` flag creates a PR with changes (same behavior as current `update --pr`)\n- [ ] `--name` flag overrides vendor key name (same behavior as current `add --name`)\n- [ ] Structured output preserved: vendor, old_version, new_version, changed (key=value lines, GITHUB_OUTPUT)\n\n### Removed files\n- [ ] `templates/add` deleted\n- [ ] `templates/update` deleted\n\n### Workflow update\n- [ ] `templates/github/workflows/install-vendored.yml` calls `.vendored/install` instead of `.vendored/update`\n- [ ] Workflow input semantics unchanged (vendor name, version)\n\n### install.sh bootstrap update\n- [ ] `install.sh` fetches `templates/install` \u2192 `.vendored/install` (instead of separate add + update)\n- [ ] `install.sh` no longer fetches or installs `.vendored/add` or `.vendored/update`\n- [ ] `install.sh` cleans up old `.vendored/add` and `.vendored/update` on upgrade\n\n### Tests\n- [ ] `tests/test_install.py` created, covering both add-path and update-path flows\n- [ ] Tests cover: version skip logic, --force override, pre-validation (add path), structured output, PR creation, multi-vendor \"all\" mode\n- [ ] `tests/test_add.py` and `tests/test_update.py` deleted\n- [ ] `tests/test_installer.py` updated for new paths (.vendored/install instead of .vendored/add + .vendored/update)\n- [ ] All tests pass","deps":[{"id":"gv-cf3f.1","type":"blocked_by"},{"id":"gv-cf3f.3","type":"blocks"}],"estimates":[{"estimator":"claude-opus-4-6","implementer":"claude-opus-4-6","cost":{"input":40000,"output":15000}}],"started_at":"2026-02-11T05:05:40Z","commit":"e811787","implementer":"claude-opus-4-6","cost":{"input":80000,"output":12000},"implemented_at":"2026-02-11T05:10:32Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T05:42:14Z","scores":{"correctness":92,"completeness":92,"quality":88,"testing":88,"documentation":82},"score":88.4},"closed_at":"2026-02-11T05:42:21Z"}
{"id":"gv-cf3f.3","title":"Add manifest emission to the vendor install contract","status":"closed","issue_type":"task","priority":1,"created_at":"2026-02-11T04:14:05Z","parent":"gv-cf3f","body":"Shift from \"vendor self-registers in config\" to \"vendor emits a file manifest, framework handles the rest.\" The framework sets env vars before running install.sh, reads the manifest after, and stores it alongside a version file.\n\n## Acceptance Criteria\n\n### Environment variables passed to install.sh\n- [ ] Framework sets `VENDOR_REPO` (owner/repo) before running install.sh\n- [ ] Framework sets `VENDOR_REF` (git ref, e.g. `v1.2.0`) before running install.sh\n- [ ] Framework sets `VENDOR_MANIFEST` (path to temp file for manifest output) before running install.sh\n- [ ] Framework passes `GH_TOKEN` for authenticated API access\n- [ ] Version is no longer passed as a positional arg to install.sh (`bash install.sh <version>` \u2192 just `bash install.sh`)\n\n### Post-install manifest handling\n- [ ] Framework reads `$VENDOR_MANIFEST` after install.sh completes\n- [ ] Validation: manifest is non-empty (at least one file listed)\n- [ ] Validation: every file listed in manifest exists on disk\n- [ ] Validation failure exits non-zero with a clear error message\n- [ ] Manifest stored at `.vendored/manifests/<vendor>.files` (one path per line, no trailing newline noise)\n- [ ] Version stored at `.vendored/manifests/<vendor>.version` (single line)\n- [ ] `.vendored/manifests/` directory created automatically if missing\n\n### Config.json update\n- [ ] `protected` field derived from manifest contents (all files in manifest + the manifest file itself + the version file)\n- [ ] Existing user-specified `allowed` entries preserved\n- [ ] `install_branch` and `repo` fields still set/updated as before\n\n### Backwards compatibility (v1 vendors)\n- [ ] If install.sh does not write to `$VENDOR_MANIFEST` (v1 vendor), framework falls back to detecting config changes (current behavior)\n- [ ] If install.sh self-registers in config (v1 behavior), framework extracts the info and does not error\n- [ ] On next install of a v1 vendor that starts emitting manifests, the transition is seamless\n\n### Tests\n- [ ] Tests for env var setup: VENDOR_REPO, VENDOR_REF, VENDOR_MANIFEST passed correctly\n- [ ] Tests for manifest validation: empty manifest, missing files, valid manifest\n- [ ] Tests for manifest storage: correct paths, correct content\n- [ ] Tests for v1 fallback: vendor that doesn't write manifest still works\n- [ ] Tests for `protected` derivation from manifest\n- [ ] All existing tests still pass","deps":[{"id":"gv-cf3f.2","type":"blocked_by"},{"id":"gv-cf3f.4","type":"blocks"},{"id":"gv-cf3f.5","type":"blocks"},{"id":"gv-cf3f.6","type":"blocks"}],"estimates":[{"estimator":"claude-opus-4-6","implementer":"claude-opus-4-6","cost":{"input":35000,"output":12000}}],"started_at":"2026-02-11T05:10:39Z","commit":"050f57e","implementer":"claude-opus-4-6","cost":{"input":50000,"output":10000},"implemented_at":"2026-02-11T05:13:54Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T05:42:44Z","scores":{"correctness":85,"completeness":80,"quality":85,"testing":82,"documentation":80},"score":82.4},"closed_at":"2026-02-11T05:42:51Z"}
{"id":"gv-cf3f.4","title":"Derive protection rules from manifests in check","status":"closed","issue_type":"task","priority":1,"created_at":"2026-02-11T04:14:28Z","parent":"gv-cf3f","body":"Update the check command to read protection rules from `.vendored/manifests/<vendor>.files` instead of the `protected` field in config.json. This completes the shift to manifest-driven protection.\n\n## Acceptance Criteria\n\n### Manifest-based protection\n- [ ] `check` reads `.vendored/manifests/<vendor>.files` for each registered vendor\n- [ ] Protected set = files listed in manifest + `.vendored/manifests/<vendor>.files` + `.vendored/manifests/<vendor>.version`\n- [ ] Changed files matched against the manifest-derived protected set (exact path match, not glob)\n- [ ] `allowed` exceptions from config.json still apply\n\n### Backwards compatibility\n- [ ] If `.vendored/manifests/<vendor>.files` does not exist, fall back to `protected` globs from config.json (v1 behavior)\n- [ ] Fallback uses existing glob matching logic (fnmatch with ** support)\n- [ ] Mixed state works: some vendors have manifests, others use config `protected`\n\n### Config migration\n- [ ] When `install` runs and creates a manifest, the `protected` field is removed from that vendor's config entry\n- [ ] This is additive to gv-cf3f.3 \u2014 the install command should stop writing `protected` to config once manifests are in use\n\n### Branch bypass\n- [ ] Install branch bypass logic unchanged: if branch matches `install_branch` prefix, skip that vendor's checks\n\n### Tests\n- [ ] Tests for manifest-based protection: exact path matching from manifest files\n- [ ] Tests for fallback to config `protected` when no manifest exists\n- [ ] Tests for mixed state: one vendor with manifest, another without\n- [ ] Tests for manifest files themselves being protected (the .files and .version files)\n- [ ] Tests for `allowed` exceptions still working with manifest-based protection\n- [ ] All existing check tests still pass (with any necessary fixture updates)","deps":[{"id":"gv-cf3f.3","type":"blocked_by"}],"estimates":[{"estimator":"claude-opus-4-6","implementer":"claude-opus-4-6","cost":{"input":25000,"output":8000}}],"started_at":"2026-02-11T05:14:02Z","commit":"6d68ad1","implementer":"claude-opus-4-6","cost":{"input":30000,"output":5000},"implemented_at":"2026-02-11T05:15:16Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T05:43:13Z","scores":{"correctness":90,"completeness":82,"quality":82,"testing":90,"documentation":80},"score":84.8},"closed_at":"2026-02-11T05:43:20Z"}
{"id":"gv-cf3f.5","title":"Create remove command for clean vendor uninstall","status":"closed","issue_type":"task","priority":1,"created_at":"2026-02-11T04:14:50Z","parent":"gv-cf3f","body":"Add a new `templates/remove` command that uses the manifest to cleanly uninstall a vendor \u2014 deleting all its files, its manifest, and its config entry.\n\n## Acceptance Criteria\n\n### Command interface\n- [ ] `templates/remove` exists, executable Python 3 script\n- [ ] Usage: `.vendored/remove <vendor>`\n- [ ] Exits non-zero with clear error if vendor not found in config.json\n- [ ] Exits non-zero with clear error if no manifest exists for the vendor (and no `protected` fallback for delete \u2014 too risky without a manifest)\n\n### Removal flow\n- [ ] Reads `.vendored/manifests/<vendor>.files` to get list of files to delete\n- [ ] Deletes every file listed in the manifest\n- [ ] Deletes `.vendored/manifests/<vendor>.files`\n- [ ] Deletes `.vendored/manifests/<vendor>.version`\n- [ ] Removes the vendor entry from `.vendored/config.json`\n- [ ] Cleans up empty parent directories left behind (e.g., if all files in `.some-tool/` are deleted, remove `.some-tool/`)\n\n### Output\n- [ ] Reports each file deleted\n- [ ] Reports summary: \"Removed vendor: <name> (N files deleted)\"\n- [ ] Handles already-missing files gracefully (warn, don't error \u2014 file may have been manually deleted)\n\n### Bootstrap\n- [ ] `install.sh` fetches `templates/remove` \u2192 `.vendored/remove` and makes it executable\n- [ ] `.vendored/remove` included in git-vendored's own self-registered protected files\n\n### Tests\n- [ ] Test: successful removal deletes all manifest files, manifest itself, and config entry\n- [ ] Test: error when vendor not in config\n- [ ] Test: error when no manifest file exists\n- [ ] Test: graceful handling of already-missing files in manifest\n- [ ] Test: empty directory cleanup after file deletion\n- [ ] Test: config.json still valid JSON after removal (other vendors unaffected)\n- [ ] All existing tests still pass","deps":[{"id":"gv-cf3f.3","type":"blocked_by"},{"id":"gv-cf3f.6","type":"blocks"},{"id":"gv-cf3f.7","type":"causes"}],"estimates":[{"estimator":"claude-opus-4-6","implementer":"claude-opus-4-6","cost":{"input":20000,"output":8000}}],"started_at":"2026-02-11T05:15:23Z","commit":"f4d8189","implementer":"claude-opus-4-6","cost":{"input":30000,"output":8000},"implemented_at":"2026-02-11T05:17:30Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T06:04:47Z","scores":{"correctness":90,"completeness":90,"quality":88,"testing":88,"documentation":82},"score":87.6},"closed_at":"2026-02-11T06:04:54Z"}
{"id":"gv-cf3f.6","title":"Rewrite bootstrap install.sh for v2 manifest contract","status":"closed","issue_type":"task","priority":1,"created_at":"2026-02-11T04:15:17Z","parent":"gv-cf3f","body":"Rewrite git-vendored's own `install.sh` (the bootstrap) to conform to the v2 vendor contract: read env vars instead of positional args, emit a manifest instead of self-registering in config, and source files from the flattened `templates/` layout.\n\n## Acceptance Criteria\n\n### v2 contract compliance\n- [ ] install.sh reads `VENDOR_REF` instead of `$1` for version (fall back to `$1` for backwards compat during transition)\n- [ ] install.sh reads `VENDOR_REPO` instead of `$2` for repo (fall back to `$2` / hardcoded default)\n- [ ] install.sh writes a manifest to `$VENDOR_MANIFEST` listing every file it creates/modifies\n- [ ] install.sh does NOT self-register in `.vendored/config.json` (framework does this now)\n- [ ] install.sh does NOT write `.vendored/.version` (framework writes `.vendored/manifests/git-vendored.version`)\n\n### Manifest contents\nThe manifest must list every file installed:\n- [ ] `.vendored/install`\n- [ ] `.vendored/check`\n- [ ] `.vendored/remove`\n- [ ] `.vendored/hooks/pre-commit`\n- [ ] `.github/workflows/install-vendored.yml`\n- [ ] `.github/workflows/check-vendor.yml`\n\n### Directory setup\n- [ ] Creates `.vendored/`, `.vendored/hooks/`, `.vendored/manifests/`, `.github/workflows/` directories\n- [ ] `.vendored/config.json` only created if missing (preserve existing \u2014 same as current behavior)\n\n### Source paths\n- [ ] All `fetch_file` calls reference `templates/` paths (already done in gv-cf3f.1, verify still correct)\n\n### Cleanup\n- [ ] Removes deprecated `.vendored/add`, `.vendored/update` (migrating from v1)\n- [ ] Removes deprecated `.vendored/.version` (replaced by manifests/<vendor>.version)\n\n### Tests\n- [ ] test_installer.py updated for v2 contract: env var inputs, manifest output, no config self-registration\n- [ ] Test: manifest file written to $VENDOR_MANIFEST path with correct contents\n- [ ] Test: config.json not modified by install.sh (framework's job)\n- [ ] Test: backwards compat \u2014 positional args still work when env vars not set\n- [ ] Test: deprecated files cleaned up on upgrade\n- [ ] All tests pass\n\n### README\n- [ ] Update README \"Vendor Contract\" section to document the v2 env var contract\n- [ ] Update README \"Quick Start\" section if bootstrap invocation changes\n- [ ] Update config schema docs: `protected` no longer in config, derived from manifests\n- [ ] Add migration note for v1 \u2192 v2","deps":[{"id":"gv-cf3f.3","type":"blocked_by"},{"id":"gv-cf3f.5","type":"blocked_by"},{"id":"gv-cf3f.8","type":"causes"},{"id":"gv-cf3f.9","type":"causes"},{"id":"gv-cf3f.10","type":"causes"},{"id":"gv-cf3f.11","type":"causes"}],"estimates":[{"estimator":"claude-opus-4-6","implementer":"claude-opus-4-6","cost":{"input":25000,"output":10000}}],"started_at":"2026-02-11T05:17:38Z","commit":"49cfcc1","implemented_at":"2026-02-11T05:20:44Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T06:05:10Z","scores":{"correctness":88,"completeness":88,"quality":85,"testing":85,"documentation":88},"score":86.8},"closed_at":"2026-02-11T06:05:17Z"}
{"id":"gv-cf3f.7","title":"Remove command should error without manifest instead of falling back to pattern scan","status":"closed","issue_type":"bug","priority":2,"created_at":"2026-02-11T05:43:50Z","parent":"gv-cf3f","references":[{"file":"templates/remove","lines":["82-109"]},{"commit":"f4d8189"}],"deps":[{"id":"gv-cf3f.5","type":"caused_by"}],"started_at":"2026-02-11T05:51:27Z","commit":"6a39ddd","implementer":"claude-opus-4-6","cost":{"input":50000,"output":8000},"implemented_at":"2026-02-11T05:53:19Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T06:05:32Z","scores":{"correctness":95,"completeness":95,"quality":92,"testing":92,"documentation":85},"score":91.8},"closed_at":"2026-02-11T06:05:38Z"}
{"id":"gv-cf3f.8","title":"install.sh doesn't read VENDOR_REF/VENDOR_REPO env vars per v2 contract","status":"closed","issue_type":"bug","priority":2,"created_at":"2026-02-11T05:44:19Z","parent":"gv-cf3f","references":[{"file":"install.sh","lines":["23-24"]},{"commit":"49cfcc1"}],"deps":[{"id":"gv-cf3f.6","type":"caused_by"}],"started_at":"2026-02-11T05:53:30Z","commit":"cf35082","implementer":"claude-opus-4-6","cost":{"input":25000,"output":5000},"implemented_at":"2026-02-11T05:54:30Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T06:05:47Z","scores":{"correctness":95,"completeness":95,"quality":92,"testing":90,"documentation":88},"score":92.0},"closed_at":"2026-02-11T06:05:53Z"}
{"id":"gv-cf3f.9","title":"install.sh still self-registers in config.json (v2 contract says framework handles this)","status":"closed","issue_type":"bug","priority":2,"created_at":"2026-02-11T05:44:23Z","parent":"gv-cf3f","references":[{"file":"install.sh","lines":["95-114"]},{"commit":"49cfcc1"}],"deps":[{"id":"gv-cf3f.6","type":"caused_by"}],"started_at":"2026-02-11T05:54:41Z","commit":"1817294","implementer":"claude-opus-4-6","cost":{"input":20000,"output":5000},"implemented_at":"2026-02-11T05:55:38Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T06:06:10Z","scores":{"correctness":95,"completeness":92,"quality":90,"testing":90,"documentation":85},"score":90.4},"closed_at":"2026-02-11T06:06:16Z"}
{"id":"gv-cf3f.10","title":"install.sh still writes deprecated .vendored/.version (should use manifests only)","status":"closed","issue_type":"bug","priority":2,"created_at":"2026-02-11T05:44:27Z","parent":"gv-cf3f","references":[{"file":"install.sh","lines":["73-75"]},{"commit":"49cfcc1"}],"deps":[{"id":"gv-cf3f.6","type":"caused_by"}],"started_at":"2026-02-11T05:55:49Z","commit":"3527e13","implementer":"claude-opus-4-6","cost":{"input":25000,"output":6000},"implemented_at":"2026-02-11T05:57:05Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T06:06:25Z","scores":{"correctness":95,"completeness":95,"quality":90,"testing":92,"documentation":82},"score":90.8},"closed_at":"2026-02-11T06:06:33Z"}
{"id":"gv-cf3f.11","title":"README not updated for v2 manifest contract (vendor contract, quick start, config schema, migration note)","status":"closed","issue_type":"bug","priority":2,"created_at":"2026-02-11T05:44:31Z","parent":"gv-cf3f","references":[{"file":"README.md"},{"commit":"49cfcc1"}],"deps":[{"id":"gv-cf3f.6","type":"caused_by"}],"started_at":"2026-02-11T05:57:16Z","commit":"22ab367","implementer":"claude-opus-4-6","cost":{"input":20000,"output":8000},"implemented_at":"2026-02-11T05:58:29Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T06:06:49Z","scores":{"correctness":92,"completeness":92,"quality":90,"testing":85,"documentation":95},"score":90.8},"closed_at":"2026-02-11T06:06:55Z"}
{"id":"gv-a34c","title":"Directory Restructure: Consolidate Vendor Files Under .vendored/","status":"open","issue_type":"epic","priority":1,"created_at":"2026-02-11T16:53:38Z","body":"Consolidate per-vendor dotdirs (`.pearls/`, `.dogfood/`, `.semver/`) and the shared `config.json` into a structured layout under `.vendored/`:\n\n- **`configs/<vendor>.json`** \u2014 per-vendor config (replaces monolithic `config.json`)\n- **`pkg/<vendor>/`** \u2014 vendor-installed files (replaces per-vendor dotdirs at repo root)\n\nThis eliminates dotdir sprawl and merge conflicts from concurrent vendor update PRs.\n\n**Depends on:** gv-cf3f (v2 contract \u2014 manifests, env vars) \u2014 all tasks closed.","deps":[{"id":"gv-cf3f","type":"blocked_by"},{"id":"gv-167c","type":"blocks"}]}
{"id":"gv-a34c.1","title":"Refactor config loading to support per-vendor config files","status":"closed","issue_type":"task","priority":1,"created_at":"2026-02-11T16:53:56Z","parent":"gv-a34c","body":"## Summary\n\nRefactor `load_config()` and `save_config()` across all three framework commands (install, check, remove) to support per-vendor config files under `.vendored/configs/`.\n\n## Acceptance Criteria\n\n- [ ] `load_config()` scans `.vendored/configs/` for `<vendor>.json` files\n- [ ] Vendor name is derived from filename (e.g., `pearls.json` \u2192 `pearls`)\n- [ ] Each `<vendor>.json` contains vendor settings directly (no wrapping `vendors` key)\n- [ ] `save_config()` in templates/install writes individual `configs/<vendor>.json`\n- [ ] `save_config()` in templates/remove deletes `configs/<vendor>.json` when removing a vendor\n- [ ] Backwards compat: falls back to monolithic `config.json` if `configs/` dir doesn't exist or has no `.json` files\n- [ ] `protected` field preserved in per-vendor config for v1 fallback compatibility\n- [ ] Tests updated in test_install.py, test_check.py, test_remove.py\n\n## Key Files\n\n- `templates/install` \u2014 `load_config()` at L39, `save_config()` at L48\n- `templates/check` \u2014 `load_config()` at L31\n- `templates/remove` \u2014 `load_config()` at L26, `save_config()` at L35\n\n## Per-vendor Config Schema\n\n```json\n{\n  \"repo\": \"owner/repo\",\n  \"install_branch\": \"chore/install-<name>\",\n  \"private\": false,\n  \"dogfood\": false,\n  \"automerge\": false,\n  \"protected\": [\"...\"],\n  \"allowed\": [\"...\"]\n}\n```\n\n## Notes\n\n- `config.json` remains on disk (for framework-level settings and migration detection)\n- The `vendors` key in `config.json` is only used during backwards-compat fallback\n- Return format from `load_config()` stays the same: `{\"vendors\": {\"name\": {...}, ...}}`","references":[{"file":"templates/install","lines":["39-45"]}],"deps":[{"id":"gv-a34c.5","type":"blocks"},{"id":"gv-a34c.6","type":"blocks"},{"id":"gv-a34c.7","type":"causes"}],"started_at":"2026-02-11T17:16:56Z","commit":"09518a6","implementer":"claude-opus-4-6","cost":{"input":85000,"output":12000},"implemented_at":"2026-02-11T17:18:55Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T18:41:31Z","scores":{"correctness":78,"completeness":88,"quality":80,"testing":82,"documentation":85},"score":82.6},"closed_at":"2026-02-11T19:17:15Z"}
{"id":"gv-a34c.2","title":"Pass VENDOR_INSTALL_DIR env var to vendor install.sh","status":"closed","issue_type":"task","priority":1,"created_at":"2026-02-11T16:54:07Z","parent":"gv-a34c","body":"## Summary\n\nPass `VENDOR_INSTALL_DIR` environment variable to vendor `install.sh` scripts so vendors can install files under `.vendored/pkg/<vendor>/`.\n\n## Acceptance Criteria\n\n- [ ] `download_and_run_install()` sets `VENDOR_INSTALL_DIR=.vendored/pkg/<vendor>` in run_env\n- [ ] Framework creates `.vendored/pkg/<vendor>/` directory before running install.sh\n- [ ] Dogfood exception: does NOT set `VENDOR_INSTALL_DIR` when vendor has `\"dogfood\": true`\n- [ ] `templates/remove` deletes `.vendored/pkg/<vendor>/` directory when removing a vendor\n- [ ] `cleanup_empty_dirs()` handles `pkg/` parent directory cleanup\n- [ ] Tests: env var set correctly, directory created, dogfood exception, removal cleans up\n\n## Key Files\n\n- `templates/install` \u2014 `download_and_run_install()` at L241, env vars at L280-285\n- `templates/remove` \u2014 `get_files_to_remove()` at L51, `cleanup_empty_dirs()` at L83\n\n## Contract\n\nVendors SHOULD install files under `$VENDOR_INSTALL_DIR` but MAY install to other paths (workflows, hooks) when the target system requires specific locations. All installed files must appear in the manifest regardless of location.\n\nIf `$VENDOR_INSTALL_DIR` is not set, vendor falls back to its original layout (backwards compat).\n\n## Notes\n\n- Manifest-based protection in `check` automatically covers pkg/ paths \u2014 no check changes needed\n- Stale file cleanup on migration (old dotdir \u2192 pkg/) is out of scope \u2014 consumers use `remove` + `install` to migrate","references":[{"file":"templates/install","lines":["241-309"]}],"deps":[{"id":"gv-a34c.6","type":"blocks"}],"started_at":"2026-02-11T17:19:06Z","commit":"8734b5e","implementer":"claude-opus-4-6","cost":{"input":30000,"output":6000},"implemented_at":"2026-02-11T17:21:52Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T18:41:34Z","scores":{"correctness":90,"completeness":90,"quality":88,"testing":90,"documentation":85},"score":88.6},"closed_at":"2026-02-11T18:42:21Z"}
{"id":"gv-a34c.3","title":"Write vendor compliance guide for directory restructure","status":"closed","issue_type":"task","priority":2,"created_at":"2026-02-11T16:54:14Z","parent":"gv-a34c","body":"## Summary\n\nWrite a markdown implementation guide that lives in the repo and instructs vendor repos (and AI tools working on them) on how to comply with the new directory structure.\n\n## Acceptance Criteria\n\n- [ ] Markdown file at `docs/vendor-install-dir-guide.md`\n- [ ] Documents `VENDOR_INSTALL_DIR` contract: env var, when it's set, expected behavior\n- [ ] Documents per-vendor config schema (fields, types, defaults)\n- [ ] Shows before/after examples of vendor file layouts\n- [ ] Provides code examples: how a vendor's `install.sh` reads and uses `$VENDOR_INSTALL_DIR`\n- [ ] Documents fallback behavior when `$VENDOR_INSTALL_DIR` is not set\n- [ ] Lists what vendor repos need to change\n- [ ] Documents migration path for consumer repos (remove + re-install)\n\n## Audience\n\nAI agents and developers working on vendor repos (pearls, git-dogfood, git-semver) who need to update their `install.sh` scripts for compatibility with the new directory structure.\n\n## Notes\n\n- Vendor repo changes are out of scope for this epic \u2014 only the guide is in scope\n- The guide should be actionable: someone reading it should know exactly what to change","deps":[{"id":"gv-a34c.4","type":"blocks"}],"started_at":"2026-02-11T17:22:03Z","commit":"caf1e88","implementer":"claude-opus-4-6","cost":{"input":12000,"output":4000},"implemented_at":"2026-02-11T17:23:02Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T18:41:38Z","scores":{"correctness":90,"completeness":90,"quality":90,"testing":85,"documentation":92},"score":89.4},"closed_at":"2026-02-11T18:42:25Z"}
{"id":"gv-a34c.4","title":"Update README and docs for new directory layout","status":"closed","issue_type":"task","priority":3,"created_at":"2026-02-11T16:54:18Z","parent":"gv-a34c","body":"## Summary\n\nUpdate the README and existing documentation to reflect the new `.vendored/` directory layout after all implementation tasks are complete.\n\n## Acceptance Criteria\n\n- [ ] README documents new `.vendored/` layout (configs/, pkg/, manifests/)\n- [ ] README documents `VENDOR_INSTALL_DIR` env var in contract/env vars section\n- [ ] README documents per-vendor config format and schema\n- [ ] Migration notes section for existing consumer repos\n- [ ] Remove references to per-vendor dotdirs at repo root as the primary layout\n\n## Key Files\n\n- `README.md`\n- Any other docs referencing the old layout","deps":[{"id":"gv-a34c.6","type":"blocked_by"},{"id":"gv-a34c.3","type":"blocked_by"}],"started_at":"2026-02-11T17:25:52Z","commit":"2d3b6cd","implementer":"claude-opus-4-6","cost":{"input":15000,"output":4000},"implemented_at":"2026-02-11T17:27:26Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T18:41:41Z","scores":{"correctness":88,"completeness":85,"quality":88,"testing":85,"documentation":90},"score":87.2},"closed_at":"2026-02-11T18:42:29Z"}
{"id":"gv-a34c.5","title":"Add config migration from monolithic config.json to per-vendor configs/","status":"closed","issue_type":"task","priority":1,"created_at":"2026-02-11T16:54:36Z","parent":"gv-a34c","body":"## Summary\n\nAdd a migration function that splits monolithic `config.json` vendors into individual `configs/<vendor>.json` files. Triggered automatically during install when monolithic config is detected.\n\n## Acceptance Criteria\n\n- [ ] `migrate_config()` function reads `config.json` `vendors` dict, writes each vendor to `configs/<vendor>.json`\n- [ ] Creates `.vendored/configs/` directory if it doesn't exist\n- [ ] Removes `vendors` key from `config.json` after successful migration (file remains for framework-level use)\n- [ ] Called from `templates/install` main() when: monolithic config has `vendors` AND `configs/` dir has no `.json` files\n- [ ] Idempotent: running migration twice doesn't duplicate or corrupt data\n- [ ] Logs migration action to stderr for visibility\n- [ ] Tests: creates correct files, cleans up config.json, idempotency\n\n## Key Files\n\n- `templates/install` \u2014 add `migrate_config()`, call from `main()` before `load_config()`\n\n## Migration Trigger Logic\n\n```python\n# In main(), before load_config():\nif os.path.exists(CONFIG_PATH):\n    with open(CONFIG_PATH) as f:\n        raw = json.load(f)\n    if \"vendors\" in raw and not any(f.endswith('.json') for f in os.listdir(CONFIGS_DIR)):\n        migrate_config(raw)\n```","deps":[{"id":"gv-a34c.1","type":"blocked_by"},{"id":"gv-a34c.6","type":"blocks"}],"references":[{"file":"templates/install","lines":["48-52"]}],"started_at":"2026-02-11T17:23:17Z","commit":"390fd1e","implementer":"claude-opus-4-6","cost":{"input":18000,"output":5000},"implemented_at":"2026-02-11T17:24:33Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T18:41:45Z","scores":{"correctness":90,"completeness":90,"quality":88,"testing":92,"documentation":82},"score":88.4},"closed_at":"2026-02-11T18:42:32Z"}
{"id":"gv-a34c.6","title":"Update bootstrap install.sh for new directory structure","status":"closed","issue_type":"task","priority":2,"created_at":"2026-02-11T16:54:43Z","parent":"gv-a34c","body":"## Summary\n\nUpdate the bootstrap `install.sh` to create the new `configs/` and `pkg/` directories during framework installation.\n\n## Acceptance Criteria\n\n- [ ] `install.sh` creates `.vendored/configs/` directory during bootstrap\n- [ ] `install.sh` creates `.vendored/pkg/` directory during bootstrap\n- [ ] Existing `mkdir -p` line updated to include new directories\n- [ ] Config migration is NOT done in install.sh \u2014 it runs when `templates/install` is invoked (keeps bash simple, migration logic in Python)\n- [ ] Tests in test_installer.py verify new directory creation\n\n## Key Files\n\n- `install.sh` \u2014 directory creation at L49\n\n## Notes\n\n- `install.sh` is a bash script that must stay simple \u2014 it just creates dirs and downloads files\n- The actual config migration runs when `templates/install` is first invoked after the framework update\n- This is blocked by Issues 1 and 2 because the directories only make sense once the commands know how to use them","deps":[{"id":"gv-a34c.1","type":"blocked_by"},{"id":"gv-a34c.2","type":"blocked_by"},{"id":"gv-a34c.5","type":"blocked_by"},{"id":"gv-a34c.4","type":"blocks"}],"references":[{"file":"install.sh","lines":["49"]}],"started_at":"2026-02-11T17:24:44Z","commit":"4bab67a","implementer":"claude-opus-4-6","cost":{"input":10000,"output":2000},"implemented_at":"2026-02-11T17:25:43Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T18:41:49Z","scores":{"correctness":92,"completeness":90,"quality":90,"testing":88,"documentation":82},"score":88.4},"closed_at":"2026-02-11T18:42:36Z"}
{"id":"gv-a34c.7","title":"install_new_vendor post-validate broken when per-vendor configs active","status":"closed","issue_type":"bug","priority":2,"created_at":"2026-02-11T18:42:06Z","parent":"gv-a34c","references":[{"file":"templates/install","lines":["427-435"]},{"commit":"09518a6"}],"deps":[{"id":"gv-a34c.1","type":"caused_by"}],"started_at":"2026-02-11T19:04:16Z","commit":"6340784","implementer":"claude-opus-4-6","cost":{"input":55000,"output":8000},"implemented_at":"2026-02-11T19:04:36Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T19:16:51Z","scores":{"correctness":90,"completeness":88,"quality":85,"testing":88,"documentation":80},"score":86.2},"closed_at":"2026-02-11T19:16:59Z"}
{"id":"gv-167c","title":"Unify vendor registry and project config under _vendor key","status":"open","issue_type":"epic","priority":1,"created_at":"2026-02-11T17:38:49Z","body":"After gv-a34c lands, per-vendor configs live at `.vendored/configs/<vendor>.json` with registry fields at the top level. This epic introduces a `_vendor` namespace key to separate framework-managed registry fields from vendor-defined project config, then merges existing per-vendor project configs into the same files.\n\n**Target schema:**\n```json\n{\n  \"_vendor\": {\n    \"repo\": \"mangimangi/pearls\",\n    \"install_branch\": \"chore/install-pearls\",\n    \"automerge\": true,\n    \"protected\": [\".vendored/pkg/pearls/**\"],\n    \"allowed\": [\".vendored/configs/pearls.json\"]\n  },\n  \"prefix\": \"gv\",\n  \"docs\": [\"AGENTS.md\"],\n  \"models\": { \"implementer\": \"claude-opus-4-6\" }\n}\n```\n\n- `_vendor` \u2014 framework-owned, written by install/remove, read by check. Underscore signals \"managed.\"\n- Top-level keys \u2014 project-owned, opaque to framework, read by the vendor tool itself.\n\n**Depends on:** gv-a34c (directory restructure \u2014 per-vendor configs and pkg/ layout).","deps":[{"id":"gv-a34c","type":"blocked_by"}]}
{"id":"gv-167c.1","title":"Introduce _vendor namespace key in load_config/save_config","status":"closed","issue_type":"task","priority":1,"created_at":"2026-02-11T17:39:06Z","parent":"gv-167c","body":"## Summary\n\nRefactor `load_config()` and `save_config()` across all framework commands so registry fields are nested under a `_vendor` key in `configs/<vendor>.json`.\n\n## Scope\n\n**Edit `templates/install`:**\n- `save_config()` writes registry fields (`repo`, `install_branch`, `protected`, `allowed`, `private`, `automerge`, `dogfood`) under `_vendor` key\n- `load_config()` reads `_vendor` key from each `configs/<vendor>.json`, returns the same `{\"vendors\": {\"name\": {...}}}` shape to callers (internal API unchanged)\n- When writing a new vendor config, preserve any existing top-level keys (project config) \u2014 only replace `_vendor`\n\n**Edit `templates/check`:**\n- `load_config()` updated to read from `_vendor` key\n\n**Edit `templates/remove`:**\n- `save_config()` deletes the whole `configs/<vendor>.json` (no change needed \u2014 removing vendor removes the entire file)\n\n## Backwards Compatibility\n\n- If `configs/<vendor>.json` has no `_vendor` key (pre-migration), treat all top-level keys as registry fields (same as gv-a34c behavior)\n- Migration from flat \u2192 `_vendor` handled in a separate task\n\n## Acceptance Criteria\n\n- [ ] `save_config()` nests registry fields under `_vendor` key\n- [ ] `load_config()` reads from `_vendor` key, returns same internal shape\n- [ ] Writing `_vendor` does not clobber top-level project config keys\n- [ ] Backwards compat: flat configs (no `_vendor` key) still load correctly\n- [ ] Tests updated in test_install.py, test_check.py, test_remove.py","deps":[{"id":"gv-167c.2","type":"blocks"},{"id":"gv-167c.4","type":"blocks"}],"estimates":[{"estimator":"claude-opus-4-6","implementer":"claude-opus-4-6","cost":{"input":60000,"output":15000}}],"started_at":"2026-02-11T20:44:26Z","commit":"b59a1d2","implementer":"claude-opus-4-6","cost":{"input":75000,"output":12000},"implemented_at":"2026-02-11T20:48:18Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T21:17:05Z","scores":{"correctness":90,"completeness":90,"quality":85,"testing":85,"documentation":80},"score":86.0},"closed_at":"2026-02-11T21:18:17Z"}
{"id":"gv-167c.2","title":"Merge per-vendor project configs into configs/<vendor>.json","status":"closed","issue_type":"task","priority":1,"created_at":"2026-02-11T17:39:20Z","parent":"gv-167c","body":"## Summary\n\nAdd a migration step that detects existing per-vendor project config files (e.g. `.pearls/config.json`, `.semver/config.json`) and merges their contents into the top level of `.vendored/configs/<vendor>.json`, alongside the `_vendor` registry key.\n\n## Scope\n\n**Edit `templates/install`:**\n- After gv-a34c's monolithic config migration runs, check each vendor for a legacy project config file\n- Detection heuristic: look for `config.json` inside the vendor's old install directory (derived from `_vendor.protected` patterns or known convention `.<vendor-name>/config.json`)\n- Merge: read legacy config, write all keys to the top level of `configs/<vendor>.json` (never overwrite `_vendor`)\n- Delete the old config file after successful merge\n- Log migration to stderr\n\n**Known legacy configs:**\n- `.pearls/config.json` \u2192 top-level keys in `.vendored/configs/pearls.json`\n- `.semver/config.json` \u2192 top-level keys in `.vendored/configs/semver.json`\n\n## Acceptance Criteria\n\n- [ ] Migration detects legacy project configs in old vendor directories\n- [ ] Contents merged into top level of `configs/<vendor>.json`\n- [ ] `_vendor` key is not affected by the merge\n- [ ] Old config files removed after successful migration\n- [ ] Idempotent: running twice doesn't duplicate or corrupt\n- [ ] Tests: merge correctness, no clobber of `_vendor`, cleanup, idempotency","deps":[{"id":"gv-167c.1","type":"blocked_by"},{"id":"gv-167c.3","type":"blocks"},{"id":"gv-167c.5","type":"blocks"}],"estimates":[{"estimator":"claude-opus-4-6","implementer":"claude-opus-4-6","cost":{"input":40000,"output":10000}}],"started_at":"2026-02-11T20:48:30Z","commit":"e84a7ed","implementer":"claude-opus-4-6","cost":{"input":30000,"output":8000},"implemented_at":"2026-02-11T20:50:02Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T21:17:20Z","scores":{"correctness":88,"completeness":90,"quality":85,"testing":90,"documentation":75},"score":85.6},"closed_at":"2026-02-11T21:18:21Z"}
{"id":"gv-167c.3","title":"Update vendor tools to read project config from .vendored/configs/","status":"closed","issue_type":"task","priority":1,"created_at":"2026-02-11T17:39:34Z","parent":"gv-167c","body":"## Summary\n\nUpdate vendored tool implementations so they read their project config from `.vendored/configs/<vendor>.json` (top-level keys, ignoring `_vendor`) instead of their old dot-directory config files.\n\n## Scope\n\n**pearls (`prl.py`):**\n- `load_config()` currently reads `.pearls/config.json`\n- Change to read `.vendored/configs/pearls.json`, parse top-level keys (ignore `_vendor`)\n- Fallback: if `.vendored/configs/pearls.json` doesn't exist, try `.pearls/config.json` (backwards compat)\n- `load_prefix()` similarly updated\n\n**git-semver (`git-semver`):**\n- `load_config()` currently reads `.semver/config.json`\n- Change to read `.vendored/configs/semver.json`, parse top-level keys (ignore `_vendor`)\n- Fallback: if `.vendored/configs/semver.json` doesn't exist, try `.semver/config.json`\n\n## Note\n\nThese are upstream vendor repo changes. In this (dogfood) repo, the vendored copies will be updated directly. Upstream repos should be updated separately to maintain the new contract.\n\n## Acceptance Criteria\n\n- [ ] prl.py reads project config from `.vendored/configs/pearls.json`\n- [ ] git-semver reads project config from `.vendored/configs/semver.json`\n- [ ] Both fall back to old location if new config doesn't exist\n- [ ] Both ignore `_vendor` key when loading project config\n- [ ] Existing tests updated or new tests added for config loading","deps":[{"id":"gv-167c.2","type":"blocked_by"},{"id":"gv-167c.5","type":"blocks"}],"estimates":[{"estimator":"claude-opus-4-6","implementer":"claude-opus-4-6","cost":{"input":45000,"output":12000}}],"started_at":"2026-02-11T20:50:15Z","commit":"01bfbca","implementer":"claude-opus-4-6","cost":{"input":25000,"output":10000},"implemented_at":"2026-02-11T20:52:16Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T21:17:32Z","scores":{"correctness":90,"completeness":90,"quality":85,"testing":85,"documentation":75},"score":85.0},"closed_at":"2026-02-11T21:18:25Z"}
{"id":"gv-167c.4","title":"Update vendor compliance guide for _vendor key and project config","status":"closed","issue_type":"task","priority":2,"created_at":"2026-02-11T17:39:46Z","parent":"gv-167c","body":"## Summary\n\nUpdate the vendor compliance guide (created in gv-a34c.3) to document the `_vendor` key convention and how vendors should read project config from the unified config file.\n\n## Scope\n\n**Edit `docs/vendor-install-dir-guide.md`:**\n- Document `_vendor` key: what it contains, who owns it, why underscore prefix\n- Document project config: top-level keys in `configs/<vendor>.json` are vendor-owned\n- Show config loading example: read file, ignore `_vendor`, use remaining keys\n- Document fallback behavior for backwards compat with old dot-dir configs\n- Update the per-vendor config schema example to show `_vendor` + project keys\n\n## Acceptance Criteria\n\n- [ ] Guide documents `_vendor` key purpose and ownership\n- [ ] Guide shows how vendors read project config from unified file\n- [ ] Guide includes code example for config loading with `_vendor` filtering\n- [ ] Guide documents fallback to legacy dot-dir config locations","deps":[{"id":"gv-167c.1","type":"blocked_by"}],"estimates":[{"estimator":"claude-opus-4-6","implementer":"claude-opus-4-6","cost":{"input":20000,"output":8000}}],"started_at":"2026-02-11T20:52:29Z","commit":"cbddf6b","implementer":"claude-opus-4-6","cost":{"input":15000,"output":5000},"implemented_at":"2026-02-11T20:53:23Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T21:17:46Z","scores":{"correctness":95,"completeness":85,"quality":90,"testing":70,"documentation":95},"score":87.0},"closed_at":"2026-02-11T21:18:28Z"}
{"id":"gv-167c.5","title":"Clean up empty vendor dot-directories after config migration","status":"closed","issue_type":"task","priority":2,"created_at":"2026-02-11T17:40:00Z","parent":"gv-167c","body":"## Summary\n\nAfter project configs have migrated into `.vendored/configs/` and vendor code into `.vendored/pkg/`, the old dot-directories (`.pearls/`, `.semver/`) may contain only data files (e.g. `issues.jsonl`) or may be empty. Clean up directories that are no longer needed.\n\n## Scope\n\n- After migration, check if old vendor dot-directories contain only files that have been moved or are now tracked elsewhere\n- `.pearls/`: `prl.py`, `merge-driver.py`, `AGENTS.md` move to `pkg/`; `config.json` merges into `configs/`; `issues.jsonl` and `archive/` are data \u2014 these may stay or move\n- `.semver/`: `git-semver` moves to `pkg/`; `config.json` merges into `configs/`; `.version` is data\n- For data files (`issues.jsonl`, `.version`), decide: move to `pkg/<vendor>/` or keep in dot-dir\n- If dot-dir is empty after moves, remove it\n- Update `.gitignore`, `.gitattributes` references as needed\n\n## Acceptance Criteria\n\n- [ ] Old dot-directories cleaned up or documented as intentionally retained\n- [ ] No orphaned config files remain in old locations\n- [ ] Data file locations decided and documented\n- [ ] .gitignore/.gitattributes updated if paths changed","deps":[{"id":"gv-167c.2","type":"blocked_by"},{"id":"gv-167c.3","type":"blocked_by"},{"id":"gv-167c.6","type":"causes"}],"estimates":[{"estimator":"claude-opus-4-6","implementer":"claude-opus-4-6","cost":{"input":35000,"output":10000}}],"started_at":"2026-02-11T20:53:38Z","commit":"1ad0393","implementer":"claude-opus-4-6","cost":{"input":10000,"output":4000},"implemented_at":"2026-02-11T20:54:49Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T21:17:59Z","scores":{"correctness":85,"completeness":50,"quality":80,"testing":80,"documentation":40},"score":67.0},"closed_at":"2026-02-11T21:29:28Z"}
{"id":"gv-167c.6","title":"Data file locations undecided and undocumented after dot-dir cleanup","status":"closed","issue_type":"bug","priority":2,"created_at":"2026-02-11T21:18:08Z","parent":"gv-167c","references":[{"file":"templates/install","lines":["815-825"]},{"commit":"1ad0393"}],"deps":[{"id":"gv-167c.5","type":"caused_by"}],"started_at":"2026-02-11T21:27:09Z","commit":"dec7ffa","implementer":"claude-opus-4-6","cost":{"input":120000,"output":8000},"implemented_at":"2026-02-11T21:29:05Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-11T21:29:13Z","scores":{"correctness":90,"completeness":95,"quality":90,"testing":85,"documentation":95},"score":91.0},"closed_at":"2026-02-11T21:29:20Z"}
{"id":"gv-e1fb","title":"Vendor Contract Validation GHA","status":"open","issue_type":"epic","priority":2,"created_at":"2026-02-12T18:01:39Z","body":"Expose vendor contract checks as a standalone validation tool and GitHub Action workflow. Allows answering \"does repo XYZ validly implement the git-vendored vendor contract?\" without actually installing the vendor.\n\nSee docs/planning/epics/gv-9d4e-validation-gha.md for full design."}
{"id":"gv-e1fb.1","title":"Create validate script with tests","status":"closed","issue_type":"task","priority":2,"created_at":"2026-02-12T18:02:10Z","parent":"gv-e1fb","body":"Standalone Python script at repo root that validates whether a given repo implements the git-vendored vendor contract, without installing it.\n\n## Script: `validate`\n\nLocation: repo root (not templates/ \u2014 this is a dev/evaluation tool, not vendored to consumers).\n\nUsage:\n    python3 validate <owner/repo> [--version <version>]\n\nEnvironment:\n    GH_TOKEN / GITHUB_TOKEN - Auth token for GitHub API access\n\n### Checks\n\nEight checks covering the full v2 vendor contract:\n\n| # | Check | Method | Fail behavior |\n|---|-------|--------|---------------|\n| 1 | Repo exists and is accessible | gh api repos/{repo} | Fail fast |\n| 2 | install.sh exists at repo root | gh api repos/{repo}/contents/install.sh | Fail fast |\n| 3 | Version resolvable | Releases API, then VERSION file fallback | Fail fast |\n| 4 | Valid shebang | Download install.sh, check first line for #!/bin/bash or #!/usr/bin/env bash | Continue |\n| 5 | Syntax valid | bash -n on downloaded script | Continue |\n| 6 | Dry-run succeeds | Run install.sh in temp dir with v2 contract env vars, exit code 0 | Continue |\n| 7 | Manifest written | Check install.sh wrote to $VENDOR_MANIFEST | Continue |\n| 8 | Manifest files exist | Verify every path in manifest exists on disk in sandbox | Continue |\n\nChecks 1-3 are fail-fast \u2014 if the repo doesn't exist or has no install.sh, stop. Checks 4-8 are collect-and-report \u2014 run all and report the full picture.\n\n### Dry-run sandbox (checks 6-8)\n\nRun install.sh in a temp directory with v2 contract env vars:\n\n| Env var | Value |\n|---------|-------|\n| VENDOR_REPO | The target owner/repo |\n| VENDOR_REF | v{resolved_version} |\n| VENDOR_MANIFEST | Temp file path for manifest output |\n| VENDOR_INSTALL_DIR | .vendored/pkg/{vendor_name}/ (relative to sandbox) |\n| GH_TOKEN | Inherited from caller |\n\nSandbox is cleaned up after validation regardless of outcome.\n\n### Output format\n\n    Validating vendor contract: owner/some-tool\n\n      [PASS] Repo exists\n      [PASS] install.sh exists\n      [PASS] Version resolvable (1.2.3)\n      [PASS] Valid shebang (#!/bin/bash)\n      [PASS] Syntax valid (bash -n passed)\n      [PASS] Dry-run install (exit code 0)\n      [PASS] Manifest written (8 files)\n      [PASS] Manifest files exist (all files found on disk)\n\n    Result: PASS (8/8 checks passed)\n\nOn failure:\n\n      [FAIL] Manifest written -- install.sh did not write to $VENDOR_MANIFEST\n\n    Result: FAIL (1/8 checks failed)\n\nExit code 0 on all-pass, 1 on any failure.\n\n### Implementation notes\n\n- Auth token resolution: check GH_TOKEN then GITHUB_TOKEN (same pattern as templates/install get_auth_token)\n- ValidationResult class for collecting pass/fail with summary\n- --help flag with usage info\n- Standalone \u2014 no imports from templates/install. The check functions are small and the contract is stable. Zero coupling to vendored templates.\n\n### Tests: tests/test_validate.py\n\nFollow the existing test patterns:\n- Import via importlib (same loader pattern as test_install.py)\n- Mock subprocess.run for gh API calls\n- pytest.raises(SystemExit) for fail-fast checks\n- Test each of the 8 checks (pass and fail cases)\n- Test fail-fast behavior (checks 1-3 stop execution)\n- Test collect-and-report behavior (checks 4-8 all run even if some fail)\n- Test output format and exit codes\n\n## Design reference\n\nSee docs/planning/epics/gv-9d4e-validation-gha.md \u2014 \"Code reuse vs. standalone\" section.","references":[{"file":"templates/install","lines":["167-190"]},{"file":"templates/install","lines":["195-243"]}],"deps":[{"id":"gv-e1fb.2","type":"blocks"}],"estimates":[{"estimator":"claude-opus-4-6","implementer":"claude-opus-4-6","cost":{"input":45000,"output":10000}}],"started_at":"2026-02-12T18:35:28Z","commit":"d04c69c","implementer":"claude-opus-4-6","cost":{"input":75000,"output":15000},"implemented_at":"2026-02-12T18:40:06Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-12T18:47:37Z","scores":{"correctness":90,"completeness":90,"quality":83,"testing":88,"documentation":82},"score":86.6},"closed_at":"2026-02-12T18:47:54Z"}
{"id":"gv-e1fb.2","title":"Create validate-vendor.yml workflow","status":"closed","issue_type":"task","priority":2,"created_at":"2026-02-12T18:02:25Z","parent":"gv-e1fb","body":"GitHub Actions workflow_dispatch workflow that runs the validate script from gv-e1fb.1.\n\n## Workflow: .github/workflows/validate-vendor.yml\n\nTrigger: workflow_dispatch with two inputs:\n\n| Input | Required | Default | Description |\n|-------|----------|---------|-------------|\n| repo | yes | \u2014 | owner/repo to validate |\n| version | no | latest | Version to validate against |\n\nPermissions: contents: read only.\n\n### Input handling\n\nInputs are passed through env vars (not shell interpolation) to prevent injection:\n\n    - name: Validate vendor contract\n      env:\n        GH_TOKEN: ${{ github.token }}\n        VALIDATE_REPO: ${{ inputs.repo }}\n        VALIDATE_VERSION: ${{ inputs.version }}\n      run: python3 validate \"$VALIDATE_REPO\" --version \"$VALIDATE_VERSION\"\n\n### Private repo support \u2014 resolved: out of scope\n\nThe workflow runs in the git-vendored repo, not in consumer repos. workflow_dispatch inputs are plain strings (not secrets), so there's no safe way to pass a token at runtime. Pre-configuring a repo secret on git-vendored for arbitrary third-party private repos doesn't make sense.\n\nPrivate repo validation is a local-only use case \u2014 run python3 validate owner/private-repo locally where GH_TOKEN is set with appropriate access. The GHA is limited to public repos (or repos accessible via github.token).\n\n### Steps\n\n1. Checkout git-vendored repo\n2. Run python3 validate with env-var-based inputs\n3. The script's own output and exit code handle reporting","deps":[{"id":"gv-e1fb.1","type":"blocked_by"}],"references":[{"file":".github/workflows/install-vendored.yml"}],"estimates":[{"estimator":"claude-opus-4-6","implementer":"claude-opus-4-6","cost":{"input":15000,"output":2000}}],"started_at":"2026-02-12T18:40:22Z","commit":"a30f12d","implementer":"claude-opus-4-6","cost":{"input":10000,"output":3000},"implemented_at":"2026-02-12T18:41:05Z","evaluation":{"evaluator":"claude-opus-4-6","evaluated_at":"2026-02-12T18:47:41Z","scores":{"correctness":92,"completeness":90,"quality":90,"testing":70,"documentation":85},"score":85.4},"closed_at":"2026-02-12T18:47:58Z"}
{"id":"gv-e19e","title":"Vendor dependency management","status":"open","issue_type":"epic","priority":2,"created_at":"2026-02-13T01:45:19Z","body":"Extend the vendor contract to support vendor-to-vendor dependencies. Vendors declare which other vendors they require via an optional deps.json at repo root, and the framework checks (and optionally installs) those dependencies during the install flow.\n\n## Motivation\n\nToday, if vendor A requires vendor B to function, there's no way to express or enforce this. The failure mode is silent: vendor A installs fine, then breaks at runtime because vendor B isn't present. Consumers have to debug missing deps themselves; vendor authors resort to README notes.\n\n## Key Design Decisions\n\n- **deps.json at repo root** (not emitted by install.sh) \u2014 deps must be checked before running install.sh\n- **Match deps by repo field**, not vendor name \u2014 handles consumers who install with custom --name\n- **Dependency modes**: error (default, safe), warn, install (auto-install), skip\n- **Version constraints deferred** \u2014 v1 is presence-only\n- **Topological sort for install all** \u2014 prevents ordering failures\n- **Cache resolved deps** in .vendored/manifests/<vendor>.deps for reverse-dep lookups\n\n## Planning Doc\n\ndocs/planning/dependency-management.md"}
{"id":"gv-e19e.1","title":"Core dependency checking (error/warn/skip modes)","status":"open","issue_type":"task","priority":1,"created_at":"2026-02-13T01:46:02Z","parent":"gv-e19e","body":"Add dependency resolution to the install flow. Vendors declare dependencies via an optional deps.json at repo root. The framework downloads, parses, and checks deps before running install.sh. Three modes are supported in this issue: error (fail on missing deps), warn (log and continue), and skip (ignore deps entirely). Auto-install mode is deferred to the next issue.\n\n## Implementation\n\n### New functions in templates/install\n\n1. **download_deps(repo, ref, token)** \u2014 Download deps.json from vendor repo at the given ref via GitHub API. Returns parsed dict or None if no deps.json exists. Uses the same gh api pattern as check_install_sh (line 180).\n\n2. **check_deps(deps, config)** \u2014 Check which declared deps are satisfied. For each dep in deps dict, check if any installed vendor has a matching repo field in its config (not by vendor name \u2014 handles custom --name). Returns tuple of (satisfied_list, missing_list) where each item is (dep_name, dep_info).\n\n3. **resolve_deps(deps, config, token, mode)** \u2014 Apply the dependency mode:\n   - \"error\": if any deps missing, print actionable error message listing each missing dep with its repo and a suggested install command, then sys.exit(1)\n   - \"warn\": if any deps missing, print warning for each, continue\n   - \"skip\": no-op, return immediately\n   - \"install\": not handled in this issue \u2014 raise an error saying \"auto-install not yet supported, use --deps=error or install deps manually\"\n\n### Wire into install flow\n\nCall resolve_deps in two places:\n- **install_new_vendor()** (line 437): after check_repo_exists + check_install_sh + resolve_version, before download_and_run_install\n- **install_existing_vendor()** (line 522): after resolve_version, before download_and_run_install. Need to download deps for the target version's ref, not the current version.\n\n### CLI flag\n\nAdd --deps argument to argparse (line 854):\n```python\nparser.add_argument(\n    \"--deps\", default=None,\n    choices=[\"error\", \"warn\", \"install\", \"skip\"],\n    help=\"Dependency handling mode (default: from config or 'error')\"\n)\n```\n\nPass args.deps through to install functions. Resolution order: CLI flag > config.json dependency_mode > default \"error\".\n\n### Config support\n\nRead optional top-level dependency_mode from config.json (not per-vendor config):\n```json\n{\"dependency_mode\": \"error\"}\n```\n\n### Cache resolved deps\n\nAfter successful install (in both install_new_vendor and install_existing_vendor), write .vendored/manifests/<vendor>.deps \u2014 one vendor name per line. This file is needed by later issues (reverse-dep check, topo sort).\n\nAdd two helper functions:\n- **write_deps(vendor_name, dep_names)** \u2014 write .deps file\n- **read_deps(vendor_name)** \u2014 read .deps file, return list or None\n\n### deps.json format\n\n```json\n{\n  \"git-semver\": {\n    \"repo\": \"mangimangi/git-semver\"\n  }\n}\n```\n\nKey is the suggested vendor name (used in error messages). \"repo\" is the owner/repo used for matching and auto-install.\n\n## Tests\n\nAdd TestDependencyResolution class in tests/test_install.py:\n\n1. test_download_deps_returns_dict \u2014 mock gh api call, verify parsed dict\n2. test_download_deps_returns_none_when_missing \u2014 mock 404 response, verify None\n3. test_check_deps_all_satisfied \u2014 deps present by repo match\n4. test_check_deps_missing \u2014 one dep not installed\n5. test_check_deps_matches_by_repo_not_name \u2014 vendor installed with custom name, dep matched by repo field\n6. test_resolve_deps_error_mode_exits \u2014 missing deps in error mode \u2192 sys.exit(1)\n7. test_resolve_deps_warn_mode_continues \u2014 missing deps in warn mode \u2192 prints warning, no exit\n8. test_resolve_deps_skip_mode_noop \u2014 skip mode does nothing\n9. test_resolve_deps_no_deps_noop \u2014 vendor has no deps.json \u2192 no-op\n10. test_deps_flag_parsed \u2014 CLI --deps=warn is parsed correctly\n11. test_deps_config_default \u2014 dependency_mode from config.json used when no CLI flag\n12. test_deps_cli_overrides_config \u2014 CLI flag takes priority over config\n13. test_write_and_read_deps \u2014 write .deps file, read it back\n14. test_deps_cached_after_install \u2014 after install_existing_vendor, .deps file exists\n\n## Acceptance Criteria\n\n- [ ] download_deps fetches and parses deps.json from vendor repo\n- [ ] check_deps matches deps by repo field, not vendor name\n- [ ] resolve_deps handles error/warn/skip modes correctly\n- [ ] --deps CLI flag works with all 4 values\n- [ ] dependency_mode read from config.json as default\n- [ ] CLI flag overrides config default\n- [ ] .vendored/manifests/<vendor>.deps written after successful install\n- [ ] All tests pass\n- [ ] No deps.json \u2192 no-op (backwards compatible)\n\n## Code References\n\n- templates/install:437 \u2014 install_new_vendor (wire in after pre-validation)\n- templates/install:522 \u2014 install_existing_vendor (wire in before download)\n- templates/install:854 \u2014 argparse CLI definition\n- templates/install:246 \u2014 manifest helpers section (add deps helpers nearby)","references":[{"file":"templates/install","lines":["437","522","854","246"]},{"file":"docs/planning/dependency-management.md"}],"deps":[{"id":"gv-e19e.2","type":"blocks"},{"id":"gv-e19e.3","type":"blocks"},{"id":"gv-e19e.4","type":"blocks"}]}
{"id":"gv-e19e.2","title":"Auto-install mode with cycle detection","status":"open","issue_type":"task","priority":1,"created_at":"2026-02-13T01:46:36Z","parent":"gv-e19e","body":"Implement the --deps=install mode that automatically installs missing dependencies before proceeding with the target vendor's install. Includes cycle detection to prevent infinite recursion, and updates the install-vendored.yml workflow template to pass --deps=install for automated runs.\n\n## Implementation\n\n### Extend resolve_deps for \"install\" mode\n\nIn resolve_deps (added in gv-e19e.1), replace the placeholder error for \"install\" mode with actual auto-install logic:\n\nFor each missing dep:\n1. Print \"  {dep_name}: not installed, auto-installing...\"\n2. Call install_new_vendor(dep_repo, \"latest\", token, installing_set=installing_set)\n3. Print \"  Added vendor: {dep_name} ({n} files)\"\n\n### Cycle detection\n\nAdd an installing_set parameter (default: None) threaded through the install call chain:\n\n- **install_new_vendor(repo, version, token, name=None, installing_set=None)** \u2014 before doing anything, check if repo is in installing_set. If yes: print \"::error::Circular dependency detected: {chain}\" and sys.exit(1). If no: add repo to set.\n- **install_existing_vendor(...)** \u2014 same pattern, pass installing_set through.\n- **resolve_deps(...)** \u2014 when mode is \"install\", pass installing_set to recursive install_new_vendor calls. Initialize installing_set as set() if None.\n\nThe chain for error messages can be built by tracking the install order as a list alongside the set.\n\n### Function signature changes\n\n```python\ndef install_new_vendor(repo, version, token, name=None, installing_set=None):\n    if installing_set is None:\n        installing_set = set()\n    if repo in installing_set:\n        print(f\"::error::Circular dependency detected: ... -> {repo}\")\n        sys.exit(1)\n    installing_set.add(repo)\n    # ... existing logic ...\n    # After pre-validation, before download_and_run_install:\n    deps = download_deps(repo, ref, token)\n    if deps:\n        resolve_deps(deps, config, token, mode, installing_set)\n    # ... rest of logic ...\n```\n\n### Workflow template update\n\nIn templates/github/workflows/install-vendored.yml, add --deps=install to the install command for automated runs:\n\n```yaml\npython3 .vendored/install \"$VENDOR\" --version \"$VERSION\" --pr --deps=install\n```\n\nThis ensures that when a vendor update introduces a new dependency, the automated workflow auto-installs it rather than failing.\n\n## Tests\n\nAdd to TestDependencyResolution in tests/test_install.py:\n\n1. test_resolve_deps_install_mode \u2014 missing dep triggers install_new_vendor call\n2. test_auto_install_recursive \u2014 dep A depends on dep B, both get installed\n3. test_circular_dependency_detected \u2014 A depends on B, B depends on A \u2192 sys.exit(1) with clear error\n4. test_self_dependency_detected \u2014 vendor depends on itself \u2192 error\n5. test_installing_set_prevents_revisit \u2014 same dep required by two vendors, only installed once\n6. test_auto_install_uses_latest_version \u2014 auto-installed deps use \"latest\" version\n7. test_workflow_template_has_deps_install \u2014 verify install-vendored.yml contains --deps=install\n\n## Acceptance Criteria\n\n- [ ] --deps=install auto-installs missing deps before target vendor\n- [ ] Recursive deps are handled (dep of dep)\n- [ ] Circular dependency detected with clear error message\n- [ ] Self-dependency detected\n- [ ] Auto-installed deps are registered in config and have manifests\n- [ ] install-vendored.yml updated with --deps=install\n- [ ] All tests pass\n\n## Code References\n\n- templates/install:437 \u2014 install_new_vendor (add installing_set param)\n- templates/install:522 \u2014 install_existing_vendor (add installing_set param)\n- templates/github/workflows/install-vendored.yml:64 \u2014 add --deps=install","deps":[{"id":"gv-e19e.1","type":"blocked_by"}],"references":[{"file":"templates/install","lines":["437","522"]},{"file":"templates/github/workflows/install-vendored.yml","lines":["64"]}]}
{"id":"gv-e19e.3","title":"Reverse dependency check on remove","status":"open","issue_type":"task","priority":2,"created_at":"2026-02-13T01:47:08Z","parent":"gv-e19e","body":"When removing a vendor, check if any other installed vendors depend on it. If so, warn the user and require --force to proceed. Also clean up .deps files during removal.\n\n## Implementation\n\n### Reverse-dep scan in templates/remove\n\nAdd a reverse_dep_check function in templates/remove. Before deleting any files:\n\n1. Read all .vendored/manifests/*.deps files\n2. For each .deps file, check if the vendor being removed appears in the list\n3. If any dependents found:\n   - Print warning listing all dependent vendors\n   - If --force not passed, prompt for confirmation (or exit in non-interactive mode)\n\n```python\ndef check_reverse_deps(vendor_name):\n    \"\"\"Check if any installed vendors depend on the given vendor.\n\n    Scans .vendored/manifests/*.deps files for references.\n    Returns list of vendor names that depend on the given vendor.\n    \"\"\"\n    dependents = []\n    if not os.path.isdir(MANIFESTS_DIR):\n        return dependents\n    for filename in os.listdir(MANIFESTS_DIR):\n        if not filename.endswith(\".deps\"):\n            continue\n        dep_vendor = filename[:-5]  # strip .deps\n        if dep_vendor == vendor_name:\n            continue  # skip self\n        filepath = os.path.join(MANIFESTS_DIR, filename)\n        with open(filepath) as f:\n            deps = [line.strip() for line in f if line.strip()]\n        if vendor_name in deps:\n            dependents.append(dep_vendor)\n    return dependents\n```\n\n### Wire into remove flow\n\nIn main() of templates/remove, after loading config and checking vendor exists, but before get_files_to_remove:\n\n```python\ndependents = check_reverse_deps(args.vendor)\nif dependents:\n    print(f\"Warning: The following vendors depend on {args.vendor}:\")\n    for d in dependents:\n        print(f\"  - {d}\")\n    if not args.force:\n        try:\n            answer = input(f\"\\nRemove anyway? [y/N] \")\n        except EOFError:\n            answer = \"\"\n        if answer.lower() not in (\"y\", \"yes\"):\n            print(\"Aborted.\")\n            sys.exit(0)\n```\n\n### Clean up .deps on remove\n\nIn get_files_to_remove, add the .deps file to the list of extra files to delete:\n\n```python\nextra = [\n    os.path.join(MANIFESTS_DIR, f\"{vendor_name}.files\"),\n    os.path.join(MANIFESTS_DIR, f\"{vendor_name}.version\"),\n    os.path.join(MANIFESTS_DIR, f\"{vendor_name}.deps\"),  # NEW\n]\n```\n\n## Tests\n\nAdd TestReverseDeps class in tests/test_remove.py:\n\n1. test_check_reverse_deps_none \u2014 no .deps files \u2192 empty list\n2. test_check_reverse_deps_found \u2014 vendor-a.deps contains \"tool\" \u2192 [\"vendor-a\"]\n3. test_check_reverse_deps_multiple \u2014 two vendors depend on same tool\n4. test_check_reverse_deps_skips_self \u2014 tool's own .deps file is ignored\n5. test_remove_warns_on_reverse_deps \u2014 removing a dep'd-on vendor prints warning\n6. test_remove_force_skips_reverse_dep_warning \u2014 --force bypasses the prompt\n7. test_remove_cleans_up_deps_file \u2014 .deps file deleted during removal\n8. test_remove_without_deps_file_still_works \u2014 vendor with no .deps file removes cleanly\n\n## Acceptance Criteria\n\n- [ ] Removing a vendor that others depend on shows a warning\n- [ ] Warning lists all dependent vendors by name\n- [ ] Without --force, user is prompted for confirmation\n- [ ] With --force, removal proceeds without prompt\n- [ ] .vendored/manifests/<vendor>.deps cleaned up during removal\n- [ ] No .deps file \u2192 no warning (backwards compatible)\n- [ ] All tests pass\n\n## Code References\n\n- templates/remove:109 \u2014 get_files_to_remove (add .deps to extra files)\n- templates/remove:156 \u2014 main() (add reverse-dep check before file listing)","deps":[{"id":"gv-e19e.1","type":"blocked_by"}],"references":[{"file":"templates/remove","lines":["109","156"]}]}
{"id":"gv-e19e.4","title":"Topological sort for install all","status":"open","issue_type":"task","priority":2,"created_at":"2026-02-13T01:47:41Z","parent":"gv-e19e","body":"When running .vendored/install all, sort vendors by their dependency graph so deps are installed/updated before the vendors that need them. This prevents ordering failures where a vendor's dep hasn't been updated yet when it's checked.\n\n## Implementation\n\n### Topological sort function\n\nAdd a topological_sort function in templates/install:\n\n```python\ndef topological_sort(vendors):\n    \"\"\"Sort vendors by dependency graph (deps first).\n\n    Reads cached .vendored/manifests/<vendor>.deps for each vendor.\n    Returns sorted list of vendor names.\n    Falls back to alphabetical order if no deps exist.\n    Detects cycles and exits with error.\n\n    Args:\n        vendors: dict of {vendor_name: vendor_config}\n\n    Returns:\n        list of vendor names in dependency order\n    \"\"\"\n```\n\nAlgorithm:\n1. Build adjacency list from .deps files: for each vendor, read its .deps, map dep names to vendor names (match by scanning configs for repo field)\n2. Kahn's algorithm (BFS-based topo sort):\n   - Compute in-degree for each node\n   - Start with nodes that have in-degree 0\n   - Process queue, decrementing in-degrees\n   - If not all nodes processed \u2192 cycle detected\n3. Vendors with no deps or no .deps file have in-degree 0 (processed first or in alphabetical order among peers)\n\n### Wire into install all\n\nIn main() (line 892), replace the simple dict iteration with topological sort:\n\n```python\nif args.target == \"all\":\n    if not vendors:\n        print(\"No vendors configured in .vendored/config.json\")\n        sys.exit(0)\n    sorted_names = topological_sort(vendors)\n    results = []\n    for name in sorted_names:\n        vcfg = vendors[name]\n        results.append(\n            install_existing_vendor(name, vcfg, args.version, args.force)\n        )\n    output_results(results)\n```\n\n### Dep name resolution\n\nThe .deps files store vendor names (e.g., \"git-semver\"). But as noted in gv-e19e.1, deps are matched by repo field for flexibility. For topo sort, we need to map dep names to installed vendor names:\n\n1. For each vendor V, read V.deps\n2. For each dep name D in V.deps:\n   a. If D is an installed vendor name \u2192 edge: D \u2192 V\n   b. Else scan all vendor configs for matching repo \u2192 edge: matched_vendor \u2192 V\n   c. If no match \u2192 dep not installed, skip edge (will be caught by resolve_deps)\n\n### Edge cases\n\n- Vendor with deps not installed \u2192 no edge added, vendor processed normally (resolve_deps handles the error)\n- Circular dependency \u2192 cycle detected in topo sort, error with list of vendors in cycle\n- All vendors independent \u2192 alphabetical order (stable, deterministic)\n\n## Tests\n\nAdd TestTopologicalSort class in tests/test_install.py:\n\n1. test_topo_sort_no_deps \u2014 all vendors independent \u2192 alphabetical order\n2. test_topo_sort_linear \u2014 A depends on B \u2192 B before A\n3. test_topo_sort_diamond \u2014 A depends on B and C, B depends on D, C depends on D \u2192 D first\n4. test_topo_sort_cycle_detected \u2014 A depends on B, B depends on A \u2192 sys.exit(1)\n5. test_topo_sort_missing_dep_ignored \u2014 dep not installed \u2192 no edge, no crash\n6. test_topo_sort_single_vendor \u2014 one vendor \u2192 returns [vendor]\n7. test_install_all_uses_topo_sort \u2014 mock topological_sort, verify it's called in install all path\n\n## Acceptance Criteria\n\n- [ ] install all processes vendors in dependency order\n- [ ] Circular dependencies detected with clear error\n- [ ] Vendors with no deps processed in stable (alphabetical) order\n- [ ] Missing deps don't crash topo sort (handled by resolve_deps separately)\n- [ ] All tests pass\n\n## Code References\n\n- templates/install:892 \u2014 main() install all path (replace iteration with topo sort)\n- templates/install:246 \u2014 manifest helpers section (add topo sort nearby)","deps":[{"id":"gv-e19e.1","type":"blocked_by"}],"references":[{"file":"templates/install","lines":["892","246"]}]}
