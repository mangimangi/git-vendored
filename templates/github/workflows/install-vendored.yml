# .github/workflows/install-vendored.yml
# Installs or updates vendored tools via .vendored/config.json.
#
# Handles all vendors from a single workflow â€” no per-vendor workflow files.
# All logic lives in .vendored/install; this workflow just provides triggers.
#
# Triggers:
#   - schedule: weekly check for all vendors
#   - workflow_dispatch: manual update of one or all vendors
#   - workflow_call: for callers like dogfood.yml
#
# Auth:
#   - GITHUB_TOKEN for public vendor repos
#   - VENDOR_PAT secret for private vendor repos (vendor.private: true)

name: Install Vendored

on:
  schedule:
    - cron: '0 9 * * 1'  # Mondays at 9am UTC
  workflow_dispatch:
    inputs:
      vendor:
        description: 'Vendor to update (or "all")'
        required: false
        default: 'all'
      version:
        description: 'Version to install (default: latest)'
        required: false
        default: 'latest'
  workflow_call:
    inputs:
      vendor:
        type: string
        required: true
      version:
        type: string
        default: 'latest'
    secrets:
      token:
        required: false

permissions:
  contents: write
  pull-requests: write

jobs:
  install:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run vendored install
        env:
          GITHUB_TOKEN: ${{ github.token }}
          VENDOR_PAT: ${{ secrets.token || secrets.VENDOR_PAT || '' }}
          GH_TOKEN: ${{ secrets.token || secrets.VENDOR_PAT || github.token }}
        run: |
          VENDOR="${{ inputs.vendor || 'all' }}"
          VERSION="${{ inputs.version || 'latest' }}"
          python3 .vendored/install "$VENDOR" --version "$VERSION" --pr
