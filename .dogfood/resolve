#!/usr/bin/env python3
"""Dogfood resolver â€” finds the vendor with dogfood: true.

Reads .vendored/config.json and outputs the vendor name that has
"dogfood": true, in GITHUB_OUTPUT format (vendor=<name>).

Usage:
    python3 .dogfood/resolve

Exit codes:
    0 - Always (outputs vendor=<name> if found, empty otherwise)
"""

import json
import os
import sys


def load_vendor_config(config_path=".vendored/config.json"):
    """Load the vendored config."""
    if not os.path.isfile(config_path):
        return None
    with open(config_path) as f:
        return json.load(f)


def find_dogfood_vendor(config):
    """Find the vendor with dogfood: true. Returns name or None."""
    vendors = config.get("vendors", {})
    for name, vcfg in vendors.items():
        if vcfg.get("dogfood") is True:
            return name
    return None


def main():
    config = load_vendor_config()
    if config is None:
        print("No .vendored/config.json found", file=sys.stderr)
        return

    vendor = find_dogfood_vendor(config)
    if vendor:
        print(f"vendor={vendor}")
    else:
        print("No vendor with dogfood: true", file=sys.stderr)


if __name__ == "__main__":
    main()
